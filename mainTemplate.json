{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
      "location": {
        "type": "string",
        "metadata": {
          "description": "location"
        }
      },
      "adminUsername": {
        "type": "string",
        "metadata": {
          "description": "Username for the Virtual Machine."
        }
      },
      "adminPassword": {
        "type": "securestring",
        "metadata": {
          "description": "Password for the Virtual Machine."
        }
      },
      "FortiGateNamePrefix": {
        "type": "string",
        "metadata": {
          "description": "Name for FortiGate virtual appliances (A & B will be appended to the end of each respectively)."
        }
      },
      "HAType": {
         "type": "string",
         "allowedValues": [
             "AA",
             "AP"
         ],
         "metadata": {
             "description": "Select between Active/Active HA using Azure load balancers and AP HA using Azure native clustering"
         }
      },
      "FortiGateImageSKU": {
        "type": "string",
        "defaultValue": "fortinet_fg-vm",
        "allowedValues": [
          "fortinet_fg-vm",
          "fortinet_fg-vm_payg"
        ],
        "metadata": {
          "description": "Identifies whether to to use PAYG (on demand licensing) or BYOL license model (where license is purchased separately)"
        }
      },
      "FortiGateVersion": {
        "type": "string",
        "defaultValue": "latest",
        "metadata": {
          "description": "5.6.3 is latest version for BYOL and PAYG; 5.2.9 is previous BYOL only"
        }
      },
      "instanceType": {
        "type": "string",
        "defaultValue": "Standard_F1",
        "metadata": {
          "description": "Virtual Machine size selection"
        }
      },
      "publicIPNewOrExisting": {
        "type": "string",
        "defaultValue": "new",
        "allowedValues": [
          "new",
          "existing"
        ],
        "metadata": {
          "description": "Identify if to use a public IP, and if so whether it's new"
        }
      },
      "publicIP2NewOrExisting": {
        "type": "string",
        "defaultValue": "new",
        "allowedValues": [
          "new",
          "existing"
        ],
        "metadata": {
          "description": "Whether to use a public IP and if so whether it is new"
        }
      },
      "publicIP3NewOrExisting": {
        "type": "string",
        "defaultValue": "new",
        "allowedValues": [
          "new",
          "existing"
        ],
        "metadata": {
          "description": "Whether to use a public IP and if so whether it is new"
        }
      },
      "publicIPAddressName": {
        "type": "string",
        "defaultValue": "",
        "metadata": {
          "description": "Name of Public IP address element."
        }
      },
      "publicIPAddressResourceGroup": {
        "type": "string",
        "defaultValue": "",
        "metadata": {
          "description": "Resource group to which the Public IP belongs."
        }
      },
      "publicIPAddress2Name": {
        "type": "string",
        "defaultValue": "",
        "metadata": {
          "description": "Name of Public IP address element."
        }
      },
      "publicIPAddress2ResourceGroup": {
        "type": "string",
        "defaultValue": "",
        "metadata": {
          "description": "Resource group to which the Public IP belongs."
        }
      },
      "publicIPAddress3Name": {
        "type": "string",
        "defaultValue": "",
        "metadata": {
          "description": "Name of Public IP address element."
        }
      },
      "publicIPAddress3ResourceGroup": {
        "type": "string",
        "defaultValue": "",
        "metadata": {
          "description": "Resource group to which the Public IP belongs."
        }
      },
      "publicIPAddressType": {
        "type": "string",
        "defaultValue": "Static",
        "allowedValues": [
          "Dynamic",
          "Static"
        ],
        "metadata": {
          "description": "Type of public IP address"
        }
      },
      "vnetNewOrExisting": {
        "type": "string",
        "defaultValue": "new",
        "allowedValues": [
          "new",
          "existing"
        ],
        "metadata": {
          "description": "Identify whether to use a new or existing vnet"
        }
      },
      "vnetName": {
        "type": "string",
        "metadata": {
          "description": "Name of the Azure virtual network."
        }
      },
      "vnetResourceGroup": {
        "type": "string",
        "defaultValue": "",
        "metadata": {
          "description": "Resource Group containing the virtual network - or new resource group from above (if new vnet)"
        }
      },
      "vnetAddressPrefix": {
        "type": "string",
        "defaultValue": "10.0.0.0/16",
        "metadata": {
          "description": "Virtual Network Address prefix"
        }
      },
      "Subnet1Name": {
        "type": "string",
        "defaultValue": "EntrySubnet",
        "metadata": {
          "description": "Subnet 1 Name"
        }
      },
      "Subnet1Prefix": {
        "type": "string",
        "defaultValue": "10.0.1.0/24",
        "metadata": {
          "description": "Subnet 1 Prefix"
        }
      },
      "Subnet2Name": {
        "type": "string",
        "defaultValue": "TransitSubnet",
        "metadata": {
          "description": "Subnet 2 Name"
        }
      },
      "Subnet2Prefix": {
        "type": "string",
        "defaultValue": "10.0.2.0/24",
        "metadata": {
          "description": "Subnet 2 Prefix"
        }
      },
      "Subnet3Name": {
        "type": "string",
        "defaultValue": "ProtectedSubnet",
        "metadata": {
          "description": "Subnet 3 Name"
        }
      },
      "Subnet3Prefix": {
        "type": "string",
        "defaultValue": "10.0.3.0/24",
        "metadata": {
          "description": "Subnet 2 Prefix"
        }
      },
      "FortinetTags": {
      "type": "object",
      "defaultValue": {
        "provider": "6EB3B02F-50E5-4A3E-8CB8-2E129258317D"
        }
      },
      "artifactsBaseUrl": {
        "type": "string",
        "defaultValue": "https://raw.githubusercontent.com/fortinetclouddev/FortiGate-HA-for-Azure/EastWestHA2.1",
        "metadata": {
          "description": "Base URL of the solution template gallery package",
          "artifactsBaseUrl": ""
        }
      }
    },
    "variables": {
        "AATemplate": "[concat(parameters('artifactsBaseURL'),'/AATemplate.json')]",
        "APTemplate": "[concat(parameters('artifactsBaseURL'),'/APTemplate.json')]"
    },
    "resources":[
        {
            "condition": "[equals(parameters('haType'), 'AA')]",
            "type": "Microsoft.Resources/deployments",
            "name": "AATemplate",
            "apiVersion": "2018-02-01",
            "properties": {
              "mode": "Incremental",
              "templateLink": {
                "uri": "[variables('AATemplate')]",
                "contentVersion": "1.0.0.0"
              },
              "parameters": {
                "location": {
                  "value": "[parameters('location')]"
                },
                "adminUsername": {
                  "value": "[parameters('adminUsername')]"
                },
                "adminPassword": {
                  "value": "[parameters('adminPassword')]"
                },
                "FortiGateNamePrefix": {
                  "value": "[parameters('FortiGateNamePrefix')]"
                },
                "FortinetTags": {
                  "value": "[parameters('FortinetTags')]"
                },
                "FortiGateImageSKU": {
                  "value": "[parameters('FortiGateImageSKU')]"
                },
                "FortiGateVersion": {
                  "value": "[parameters('FortiGateVersion')]"
                },
                "instanceType": {
                  "value": "[parameters('instanceType')]"
                },
                "publicIPNewOrExisting": {
                  "value": "[parameters('publicIPNewOrExisting')]"
                },
                "publicIP2NewOrExisting": {
                  "value": "[parameters('publicIP2NewOrExisting')]"
                },
                "publicIP3NewOrExisting": {
                  "value": "[parameters('publicIP3NewOrExisting')]"
                },
                "publicIPAddressName": {
                  "value": "[parameters('publicIPAddressName')]"
                },
                "publicIPAddressResourceGroup": {
                  "value": "[parameters('publicIPAddressResourceGroup')]"
                },
                "publicIPAddress2Name": {
                  "value": "[parameters('publicIPAddress2Name')]"
                },
                "publicIPAddress2ResourceGroup": {
                  "value": "[parameters('publicIPAddress2ResourceGroup')]"
                },
                "publicIPAddress3Name": {
                  "value": "[parameters('publicIPAddress3Name')]"
                },
                "publicIPAddress3ResourceGroup": {
                  "value": "[parameters('publicIPAddress3ResourceGroup')]"
                },
                "publicIPAddressType": {
                  "value": "[parameters('publicIPAddressType')]"
                },
                "vnetNewOrExisting": {
                  "value": "[parameters('vnetNewOrExisting')]"
                },
                "vnetName": {
                  "value": "[parameters('vnetName')]"
                },
                "vnetResourceGroup": {
                  "value": "[parameters('vnetResourceGroup')]"
                },
                "vnetAddressPrefix": {
                  "value": "[parameters('vnetAddressPrefix')]"
                },
                "Subnet1Name": {
                  "value": "[parameters('Subnet1Name')]"
                },
                "Subnet1Prefix": {
                  "value": "[parameters('Subnet1Prefix')]"
                },
                "Subnet2Name": {
                  "value": "[parameters('Subnet2Name')]"
                },
                "Subnet2Prefix": {
                  "value": "[parameters('Subnet2Prefix')]"
                },
                "Subnet3Name": {
                  "value": "[parameters('Subnet3Name')]"
                },
                "Subnet3Prefix": {
                  "value": "[parameters('Subnet3Prefix')]"
                },
                "artifactsBaseUrl": {
                  "value": "[parameters('artifactsBaseUrl')]"
                }
              }
            }
          },
          {
            "condition": "[equals(parameters('haType'), 'AP')]",
            "type": "Microsoft.Resources/deployments",
            "name": "APTemplate",
            "apiVersion": "2018-02-01",
            "properties": {
              "mode": "Incremental",
              "templateLink": {
                "uri": "[variables('APTemplate')]",
                "contentVersion": "1.0.0.0"
              },
              "parameters": {
                "location": {
                  "value": "[parameters('location')]"
                },
                "adminUsername": {
                  "value": "[parameters('adminUsername')]"
                },
                "adminPassword": {
                  "value": "[parameters('adminPassword')]"
                },
                "FortiGateNamePrefix": {
                  "value": "[parameters('FortiGateNamePrefix')]"
                },
                "FortinetTags": {
                  "value": "[parameters('FortinetTags')]"
                },
                "FortiGateImageSKU": {
                  "value": "[parameters('FortiGateImageSKU')]"
                },
                "FortiGateVersion": {
                  "value": "[parameters('FortiGateVersion')]"
                },
                "instanceType": {
                  "value": "[parameters('instanceType')]"
                },
                "publicIPNewOrExisting": {
                  "value": "[parameters('publicIPNewOrExisting')]"
                },
                "publicIP2NewOrExisting": {
                  "value": "[parameters('publicIP2NewOrExisting')]"
                },
                "publicIP3NewOrExisting": {
                  "value": "[parameters('publicIP3NewOrExisting')]"
                },
                "publicIPAddressName": {
                  "value": "[parameters('publicIPAddressName')]"
                },
                "publicIPAddressResourceGroup": {
                  "value": "[parameters('publicIPAddressResourceGroup')]"
                },
                "publicIPAddress2Name": {
                  "value": "[parameters('publicIPAddress2Name')]"
                },
                "publicIPAddress2ResourceGroup": {
                  "value": "[parameters('publicIPAddress2ResourceGroup')]"
                },
                "publicIPAddress3Name": {
                  "value": "[parameters('publicIPAddress3Name')]"
                },
                "publicIPAddress3ResourceGroup": {
                  "value": "[parameters('publicIPAddress3ResourceGroup')]"
                },
                "publicIPAddressType": {
                  "value": "[parameters('publicIPAddressType')]"
                },
                "vnetNewOrExisting": {
                  "value": "[parameters('vnetNewOrExisting')]"
                },
                "vnetName": {
                  "value": "[parameters('vnetName')]"
                },
                "vnetResourceGroup": {
                  "value": "[parameters('vnetResourceGroup')]"
                },
                "vnetAddressPrefix": {
                  "value": "[parameters('vnetAddressPrefix')]"
                },
                "Subnet1Name": {
                  "value": "[parameters('Subnet1Name')]"
                },
                "Subnet1Prefix": {
                  "value": "[parameters('Subnet1Prefix')]"
                },
                "Subnet2Name": {
                  "value": "[parameters('Subnet2Name')]"
                },
                "Subnet2Prefix": {
                  "value": "[parameters('Subnet2Prefix')]"
                },
                "Subnet3Name": {
                  "value": "[parameters('Subnet3Name')]"
                },
                "Subnet3Prefix": {
                  "value": "[parameters('Subnet3Prefix')]"
                },
                "artifactsBaseUrl": {
                  "value": "[parameters('artifactsBaseUrl')]"
                }
              }
            }
          }
    ]
}